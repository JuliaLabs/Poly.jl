<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Poly.jl Documentation · Poly.jl Documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Poly.jl Documentation</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Poly.jl Documentation</a><ul class="internal"><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Poly.jl Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Poly.jl Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaLabs/Poly.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Poly.jl-Documentation"><a class="docs-heading-anchor" href="#Poly.jl-Documentation">Poly.jl Documentation</a><a id="Poly.jl-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Poly.jl-Documentation" title="Permalink"></a></h1><ul><li><a href="#Poly.jl-Documentation">Poly.jl Documentation</a></li><ul><li><a href="#Functions">Functions</a></li><li><a href="#Index">Index</a></li></ul></ul><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Poly.@poly_loop-Tuple" href="#Poly.@poly_loop-Tuple"><code>Poly.@poly_loop</code></a> — <span class="docstring-category">Macro</span></header><section><div><p>Runs a Polyhedral model on the input for loop. May reorder instructions (including loop orderings) and vectorize code. Only the outermost loop should use the macro. By default, will also tile code. See below for more details.</p><p><strong>Example</strong></p><pre><code class="language-julia">@poly_loop for i = 1:n
    for j = 1:m
        for k = 1:r
            out[i, j] += A[i, k] * B[k, j]
        end
        out[i, j] *= 2
    end
end</code></pre><p>(runs a matrix multiplication and double)</p><div class="admonition is-info"><header class="admonition-header">Loop Types</header><div class="admonition-body"><p><code>@poly_loop</code> requires a normal for loop (i.e <code>i = lowerbound:upperbound</code> or <code>i = lowerbound:step:upperbound</code>)</p></div></div><p><strong>Tiling</strong></p><p>Loops will be automatically tiled based on l1 cache sizes unless <code>tile=0</code> is set.</p><p><strong>Example No Tiling:</strong></p><pre><code class="language-julia">@poly_loop tile=0 for i=1:n
    arr[i] = 1.0
end</code></pre><p>Tiling is usually faster, but in cases where the loop bounds are small it will just introduce more loop overhead. Unless <code>tile=0</code> is set, the outermost band (grouping of permutable loops) will be tiled.</p><div class="admonition is-warning"><header class="admonition-header">Invalid Tiling</header><div class="admonition-body"><p>Some non-uniform access patterns can result in invalid tiling. This is pretty rare. If this occurs, code will likely error during compilation.</p></div></div><p><strong>Threading</strong></p><p>To enable multithreading of the outermost loop, pass thread=true (disabled by default):</p><p><strong>Example:</strong></p><pre><code class="language-julia">@poly_loop thread=true for i=1:n
    arr[i] = 1.0
end</code></pre><div class="admonition is-info"><header class="admonition-header">Threading Condition</header><div class="admonition-body"><p>Julia must be run with <code>julia --threads=auto</code> (or a number of threads instead of <code>auto</code>) to enable threading at all.</p></div></div><p><strong>Debugging</strong></p><p>Debugging and verbosity options (see run<em>polyhedral</em>model for details) can be passed like:</p><pre><code class="language-julia-repl">julia&gt; @poly_loop debug=true verbose=2 for i=1:4:n-1
    arr[i] *= arr[i + 1]
end</code></pre><p>This will print out the following information, depending on the verbosity level set:</p><ul><li>0: no printing (unless <code>debug=true</code>, where ISL errors are printed)</li><li>1: final Julia expression is printed</li><li>2: initial C code, loop orderings, new schedule, final C code, and final Julia expression printed</li><li>3: all of 2 plus domain, access relations, dependence relations, original schedule, and new schedule constraints printed</li></ul><p><strong>Functions</strong></p><div class="admonition is-warning"><header class="admonition-header">Functions</header><div class="admonition-body"><p>Function calls are not currently supported in most cases</p></div></div><p>If a function modifies any inputs, then there is no way to know which inputs are modified or how those inputs are modified. If a function returns an output such as a matrix, the write to each individual index of the matrix (for example <code>A[i, j]</code>) cannot be inferrred by ISL. In addition, <code>@inbounds</code> is not neccessary (or allowed) as the aggresive transformation will add <code>@inbounds</code> automatically.</p><p><strong>Loop Bounds</strong></p><p>This also applies to loop bounds. One easy workaround is something like:</p><pre><code class="language-julia-repl">juila&gt; n = size(out, 1)
julia&gt; @poly_loop for i = 1:n
    out[i] += 1.0
end</code></pre><p><strong>Exceptions</strong></p><p>The only exceptions are the following functions (which can be used in loop bounds and in instructions): <code>min()</code>:</p><pre><code class="language-julia">@poly_loop for i=1:min(n, m)
    arr[i, i] = 1.0
end</code></pre><p><code>max()</code>:</p><pre><code class="language-julia">@poly_loop for i=1:max(n, m)
    arr[i, i] -= 1.0
end</code></pre><p><code>floor()</code> -&gt; DO NOT cast to <code>Int()</code> (will be added later):</p><pre><code class="language-julia">@poly_loop for i=1:floor(n/2)
    arr[i] += 1.0
end</code></pre><div class="admonition is-info"><header class="admonition-header">Loop Names</header><div class="admonition-body"><p>All loop iterators must have unique symbols, even if in different scopes. This is so an original schedule can be extracted from the code.</p></div></div><p><strong>Example</strong></p><pre><code class="language-julia">@poly_loop for i=1:n
    for j=1:floor(n/2)
        arr[i, j] += 1.0
    end
    for jj=floor(n/2):n
        arr[i, j] *= 2.0
    end
end</code></pre><p><strong>Interpolation</strong></p><div class="admonition is-warning"><header class="admonition-header">Striding</header><div class="admonition-body"><p>ISL does not work with non-numerical striding, i.e. <code>for i=1:TILE:n</code>.</p></div></div><p>As a workaround, this macro supports interpolating the values into the function so that ISL has access to the numerical values (and non-numerical strides MUST be interpolated). This delays the analysis to runtime, so it is advised that interpolated values are typically constant so that compilation does not occur over and over.</p><p><strong>Examples:</strong></p><pre><code class="language-julia">@poly_loop for i=1:$c:n
    arr[i] = 1
end</code></pre><pre><code class="language-julia">@poly_loop for i=1:$c:$n
    arr[i] = 1
end</code></pre><p>In addition, any constants can be interpolated, and sometimes this may improve the performance of ISL. Numerical bounds can help with tiling and inference on spaces. However, it is important that interpolated values are actually constants, or very rarely change, so that this delayed compilation does not occur regularly during runtime.</p><div class="admonition is-info"><header class="admonition-header">Indexing</header><div class="admonition-body"><p>All array indices must be in terms of loop bounds or constants, not of variables.</p></div></div><p><strong>Example:</strong></p><pre><code class="language-julia-repl">julia&gt; c = i + j
julia&gt; A[c]</code></pre><p>Must become</p><pre><code class="language-julia-repl">julia&gt; A[i + j]</code></pre><div class="admonition is-warning"><header class="admonition-header">Multiplicative Indexing</header><div class="admonition-body"><p>Multilpicative indexing (i.e. <code>A[i*t, j]</code>) is not supported. If needed, stride over the iterator.</p></div></div><p><strong>Example:</strong></p><pre><code class="language-julia">NUM_TILES = Int(N/TILE_SIZE)
@poly_loop for t=1:NUM_TILES
    A[TILE_SIZE*t] = 1
end</code></pre><p>Would need to become this:</p><pre><code class="language-julia">@poly_loop for t=1:$TILE_SIZE:N
    A[t] = 1
end</code></pre><p><strong>If/elseif/else blocks:</strong></p><div class="admonition is-info"><header class="admonition-header">If Block Conditions</header><div class="admonition-body"><p>If blocks must contain conditions on the loop iterators and constants only (not on any elements of an array, for example)</p></div></div><p><strong>Example:</strong></p><pre><code class="language-julia">@poly_loop for i=1:n
    if i%2 == 0
        A[i] = 1
    else
        A[i] = 2
    end
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLabs/Poly.jl/blob/af4347bbaa1c4eec99d92e57f984540fb9da4856/src/macros.jl#L153-L328">source</a></section></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#Poly.@poly_loop-Tuple"><code>Poly.@poly_loop</code></a></li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 14 September 2021 22:34">Tuesday 14 September 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
